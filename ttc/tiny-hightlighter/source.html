<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <script>const CMsettings={path:"../../codemirror",indentOnInit:!0,config:{mode:"htmlmixed",theme:"default",lineNumbers:!0,lineWrapping:!0,indentUnit:2,tabSize:2,indentWithTabs:!0,matchBrackets:!0,saveCursorPosition:!0,styleActiveLine:!0},jsFiles:["lib/codemirror.min.js","addon/edit/matchbrackets.min.js","mode/xml/xml.min.js","mode/javascript/javascript.min.js","mode/css/css.min.js","mode/htmlmixed/htmlmixed.min.js","addon/dialog/dialog.min.js","addon/search/searchcursor.min.js","addon/search/search.min.js","addon/selection/active-line.min.js"],cssFiles:["lib/codemirror.css","addon/dialog/dialog.css"]};let tinymce,editor,codemirror,chr=0;const isMac=/macintosh|mac os/i.test(navigator.userAgent),findDepth=(e,t)=>{let s=0;for(let i=e.indexOf(t)-1;i>=0;i--)switch(e.charAt(i)){case"<":s--;break;case">":case"&":s++}return s};window.submit=()=>{const e="&#x0;",t=codemirror.isDirty,s=codemirror.doc;s.somethingSelected()&&s.setCursor(s.getCursor()),s.replaceSelection(e);var i=codemirror.getCursor(),n=s.getLine(i.line);0!==findDepth(n,e)&&(n=n.replace(e,""),s.replaceRange(n,CodeMirror.Pos(i.line,0),CodeMirror.Pos(i.line)));const o=codemirror.getValue(),r=new RegExp("<script(.*?)>(.*?)&#x0;(.*?)<\/script>","ms"),c=new RegExp("<style(.*?)>(.*?)&#x0;(.*?)</style>","ms"),d=new RegExp("<[^>]*(&#x0;).*>|^(&#x0;)|(&#x0;)$");-1!==o.search(r)||-1!==o.search(c)||-1!==o.search(d)?editor.setContent(o.replace(e,"")):editor.setContent(o.replace(e,'<span id="CmCaReT"></span>')),editor.isNotDirty=!t,t&&editor.nodeChanged();var a=editor.dom.select("span#CmCaReT")[0];a&&(editor.selection.scrollIntoView(a),editor.selection.setCursorLocation(a,0),editor.dom.remove(a))};const start=()=>{if("function"!=typeof window.CodeMirror)throw new Error(`CodeMirror not found in "${CMsettings.path}", aborting...`);const e=parent.document.querySelectorAll(".tox-dialog__footer")[0],t=parent.document.createElement("div"),s='<td style="font-size:11px;background:#777;color:#fff;padding:0 4px">',i='<td style="font-size:11px;padding-right:5px">';t.innerHTML=`\n<table cellspacing="0" cellpadding="0" style="border-spacing:4px">\n  <tr>\n    ${s}${isMac?"&#8984;-F":"Ctrl-F</td>"}${i}${tinymce.translate("Start search")}</td>\n    ${s}${isMac?"&#8984;-G":"Ctrl-G"}</td>\n    ${i}${tinymce.translate("Find next")}</td>\n    ${s}${isMac?"&#8984;-Alt-F":"Shift-Ctrl-F"}</td>\n    ${i}${tinymce.translate("Find previous")}</td>\n  </tr>\n  <tr>\n    ${s}${isMac?"&#8984;-Alt-F":"Shift-Ctrl-F"}</td>\n    ${i}${tinymce.translate("Replace")}</td>\n    ${s}${isMac?"Shift-&#8984;-Alt-F":"Shift-Ctrl-R"}</td>\n    ${i}${tinymce.translate("Replace all")}</td>\n  </tr>\n</table>`,t.style.position="absolute",t.style.left=t.style.bottom="5px",e.appendChild(t);let n=editor.getContent({source_view:!0});n=n.replace(/<span\s+style="display: none;"\s+class="CmCaReT"([^>]*)>([^<]*)<\/span>/gm,String.fromCharCode(chr)),editor.dom.remove(editor.dom.select(".CmCaReT")),tinymce.each(editor.contextToolbars,(e=>{e.panel&&e.panel.hide()})),CodeMirror.defineInitHook((e=>{e.focus();const t=e.getSearchCursor(String.fromCharCode(chr),!1);if(t.findNext()&&(e.setCursor(t.to()),t.replace("")),editor.settings.codemirror.indentOnInit){const t=e.lineCount();e.operation((function(){for(let s=0;s<t;++s)e.indentLine(s)}))}})),CMsettings.config.value=n,codemirror=CodeMirror(document.body,CMsettings.config),codemirror.isDirty=!1,codemirror.on("change",(e=>{e.isDirty=!0}))};document.onkeydown=e=>{let t=!1;t="key"in(e=e||window.event)?"Escape"===e.key||"Esc"===e.key:27===e.keyCode,t&&tinymce.activeEditor.windowManager.close()},(()=>{if(tinymce=parent.tinymce,!tinymce)throw new Error("tinyMCE not found");editor=tinymce.activeEditor;const e=editor.settings.codemirror;e.fullscreen&&(CMsettings.jsFiles.push("addon/display/fullscreen.min.js"),CMsettings.cssFiles.push("addon/display/fullscreen.css"));for(const t in e.config)CMsettings.config[t]=e.config[t];for(const t in e.jsFiles)CMsettings.jsFiles.includes(e.jsFiles[t])||CMsettings.jsFiles.push(e.jsFiles[t]);for(const t in e.cssFiles)CMsettings.cssFiles.includes(e.cssFiles[t])||CMsettings.cssFiles.push(e.cssFiles[t]);/\/$/.test(CMsettings.path)||(CMsettings.path+="/");for(let e=0;e<CMsettings.cssFiles.length;e++)document.write('<link rel="stylesheet" type="text/css" href="'+CMsettings.path+CMsettings.cssFiles[e]+'" />');for(let e=0;e<CMsettings.jsFiles.length;e++)document.write('<script type="text/javascript" src="'+CMsettings.path+CMsettings.jsFiles[e]+'"><\/script>');CMsettings.config.theme&&(document.documentElement.className+=CMsettings.config.theme.replace(/(^|\s)\s*/g," cm-s-")),window.onload=start})();</script>
    <style type="text/css">body,html{height:100%}body{margin:0}.CodeMirror{font-size:12px;height:100%;line-height:18px}.CodeMirror-activeline-background{background:#e8f2ff!important}.cm-trailingspace{background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAQAAAACCAYAAAB/qH1jAAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH3QUXCToH00Y1UgAAACFJREFUCNdjPMDBUc/AwNDAAAFMTAwMDA0OP34wQgX/AQBYgwYEx4f9lQAAAABJRU5ErkJggg==);background-position:0 100%;background-repeat:repeat-x}</style>
  </head>
  <body></body>
</html>
